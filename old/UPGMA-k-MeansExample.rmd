---
title: "Dimensionality Reduction as Dendrograms"
author: "Colby Ford"
date: "December 12, 2017"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Converting Dimensionality Reduction Analyses to Dendrograms

In this example, we will be using the iris dataset that is included with R. To begin, load the required 'reshape' package as well as the iris data.

```{r iris}
library(reshape)
data(iris)

summary(iris)
head(iris)
```

## UPGMA Example

UPGMA and other hierarchical clustering algorithms can be used to cluster data recursively using their relative distances.
First, we must reshape the date to melt it into a usable form. Then, cast (pivot) the data to get the average values for each variable and species.

```{r hclust, echo=FALSE}
hirisclustermelt <- melt(iris, id = c("Species")) #Reshape the data
hirisclustermeans <- cast(hirisclustermelt, Species~variable, mean) #Pivot and summarize
hirisclustermeans[is.na(hirisclustermeans)] <- 0 #Impute 0's for NaNs

head(hirisclustermeans)
```

The output of the UPGMA algorithm can be visualized as a dendrogram.

```{r hplot echo=FALSE}
#Plot Dendrogram using Distance Matrix
plot(hclust(dist(hirisclustermeans[, 2:5]), method = "average"),
     labels = hirisclustermeans[,1],
     main = "UPGMA Hierarchical Clustering Dendrogram")
```

## k-Means to Dendrogram Example

For any other clustering or dimensionality reduction algorithm, the output will likely be a projection of the data into a smaller dimensional space. In this example, we will take the k-Means clustering algorithm (with k=3) and project the iris dataset into 3 dimension. Then, we will convert the output into a dendrogram.

```{r kclust 1}
#Assign data points to clusters (with k=3 clusters)
kclusters <- kmeans((iris[, 1:4]), 3, iter.max = 10)
summary(kclusters)
```

Once we get the clusters from the k-Means analysis, we will then need to append that information to the original dataset. Plus, we will do the same reshaping and pivoting steps as before.

```{r kclust 2}
kiris <- data.frame(iris, cluster = kclusters$cluster) #Append the cluster assignment to the dataframe
kirisclustermelt <- melt(kiris, id = c("Species", "cluster")) #Reshape the data
kirisclustermeans <- cast(kirisclustermelt, Species~cluster+variable, mean) #Pivot and summarize
kirisclustermeans[is.na(kirisclustermeans)] <- 0 #Impute 0's for NaNs

head(kirisclustermeans)
```

After this reshaping is complete, the output of the k-Means algorithm can be visualized as a dendrogram just as with UPGMA.

```{r hplot echo=FALSE}
#Plot Dendrogram using Cluster Averages
plot(hclust(dist(kirisclustermeans[, 2:4]), method = "average"),
     labels = kirisclustermeans[,1],
     main = "k-Means Clustering Dendrogram")
```